#!/usr/bin/with-contenv bash

if [ ! "$(stat -c %U /app)" = "${COMPANY_NAME}" ]
then
  chown -R ${COMPANY_NAME}:${COMPANY_NAME} /config
fi

if [ ! "$(stat -c %U /archive)" = "${COMPANY_NAME}" ]
then
  chown -R ${COMPANY_NAME}:${COMPANY_NAME} /archive
fi

if [ ! "$(stat -c %U /config)" = "${COMPANY_NAME}" ]
then
  chown -R ${COMPANY_NAME}:${COMPANY_NAME} /config
fi

if [ ! "$(stat -c %U /opt)" = "${COMPANY_NAME}" ]
then
  chown -R ${COMPANY_NAME}:${COMPANY_NAME} /media
fi

if [[ ! -d /config/var ]]
then
  mv /opt/${COMPANY_NAME}/mediaserver/var /config/var
fi

if [[ ! -h /opt/${COMPANY_NAME}/mediaserver/var ]]
then
  rm -rf /opt/${COMPANY_NAME}/mediaserver/var
  ln -s /config/var /opt/${COMPANY_NAME}/mediaserver/var
fi

if [[ ! -d /config/etc ]]
then
  mv /opt/${COMPANY_NAME}/mediaserver/etc /config/etc
fi

if [[ ! -h /opt/${COMPANY_NAME}/mediaserver/etc ]]
then
  rm -rf /opt/${COMPANY_NAME}/mediaserver/etc
  ln -s /config/etc /opt/${COMPANY_NAME}/mediaserver/etc
fi
